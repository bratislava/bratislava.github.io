"use strict";(self.webpackChunkbratislava_github_io=self.webpackChunkbratislava_github_io||[]).push([[2408],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>c});var i=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),d=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},f=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),f=d(n),c=r,h=f["".concat(s,".").concat(c)]||f[c]||u[c]||a;return n?i.createElement(h,o(o({ref:t},p),{},{components:n})):i.createElement(h,o({ref:t},p))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=f;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<a;d++)o[d]=n[d];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}f.displayName="MDXCreateElement"},9796:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var i=n(7462),r=(n(7294),n(3905));const a={},o="Upload file",l={unversionedId:"bratislava.sk/forms-upload-file",id:"bratislava.sk/forms-upload-file",title:"Upload file",description:"For purposes of uploading a file in the form, we are using the widget Upload. This widget has 2 types: button and drag&drop.",source:"@site/docs/bratislava.sk/forms-upload-file.md",sourceDirName:"bratislava.sk",slug:"/bratislava.sk/forms-upload-file",permalink:"/docs/bratislava.sk/forms-upload-file",draft:!1,editUrl:"https://github.com/bratislava/bratislava.github.io/edit/master/docs/bratislava.sk/forms-upload-file.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Custom RJSF widgets",permalink:"/docs/bratislava.sk/forms-uischema"},next:{title:"Meilisearch setup",permalink:"/docs/bratislava.sk/meilisearch-setup"}},s={},d=[{value:"Upload file on frontend",id:"upload-file-on-frontend",level:2},{value:"Upload file on the server",id:"upload-file-on-the-server",level:2},{value:"Delete file",id:"delete-file",level:2},{value:"Usage in RJSF",id:"usage-in-rjsf",level:2}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"upload-file"},"Upload file"),(0,r.kt)("p",null,"For purposes of uploading a file in the form, we are using the widget ",(0,r.kt)("strong",{parentName:"p"},"Upload"),". This widget has 2 types: ",(0,r.kt)("strong",{parentName:"p"},"button")," and ",(0,r.kt)("strong",{parentName:"p"},"drag&drop"),".\nUpload widget can upload one or more files. We can set these settings in uiSchema, also with the restriction of accepted file extensions and size of the file."),(0,r.kt)("h2",{id:"upload-file-on-frontend"},"Upload file on frontend"),(0,r.kt)("p",null,"When we choose one or multiple files, at first they are ",(0,r.kt)("strong",{parentName:"p"},"validated"),". We must check if their size is up to set ",(0,r.kt)("strong",{parentName:"p"},"maximum file size"),".\nIn case we dropped files, we must also check if their ",(0,r.kt)("strong",{parentName:"p"},"extension is accepted"),". If the file is validated without errors,\nit's sent to the server by endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/eforms/upload-file")," and added to the list of files under the widget with a loading spinner.\nIf there are some frontend errors, the file is not added to the file list under the widget but info about an error is written under the widget."),(0,r.kt)("p",null,"The file name will be also changed before sending it to the server. Timestamp and random hash are added as prefixes,\ndivided by character _ between timestamp, random hash, and original name. We can also describe it by this format\n",(0,r.kt)("inlineCode",{parentName:"p"},"timestamp_randomHash_originalFileName.fileExtension"),". The file will be saved on the server with this name."),(0,r.kt)("h2",{id:"upload-file-on-the-server"},"Upload file on the server"),(0,r.kt)("p",null,"After frontend validation, every file is separately sent to endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/eforms/upload-file")," by Rest API post request.\nWe use ",(0,r.kt)("strong",{parentName:"p"},"S3 Bucket")," to save files on the server. For Node implementation, we use the library ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/minio"},"minio"),".\nAt this moment, we don't have implemented S3 Bucket on our server, so we use ",(0,r.kt)("a",{parentName:"p",href:"https://play.min.io"},"minio playground"),".\nIt's possible to create public buckets here. Public login uses accessKey as username and secretKey as password.\nYou can find both at ",(0,r.kt)("inlineCode",{parentName:"p"},"/backend/utils/minio-client.ts"),". When our own S3 bucket on the server will be prepared, it's just\nnecessary to change info in minioClient inside that file."),(0,r.kt)("p",null,"Before uploading of a file, the Minio client is testing if our S3 bucket exists. If not, it would create new. When the Minio client is sure,\nthat bucket exists, it will upload and save files inside. The endpoint is returning JSON with info about success or failure.\nIf any error occurred on the server, the file in the list of files under the Upload widget on frontend will be marked with red color."),(0,r.kt)("h2",{id:"delete-file"},"Delete file"),(0,r.kt)("p",null,"It's possible to delete the uploaded files by ",(0,r.kt)("strong",{parentName:"p"},"clicking")," on the trash icon next to the file in the list of files under the Upload widget on frontend.\nRest API delete request is called at endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/eforms/delete-file"),". The server will test if S3 bucket exists and if not,\nit will throw an error because there is no reason to create any bucket, when we want to delete something we think it's already created.\nIf a bucket exists, Minio client ",(0,r.kt)("strong",{parentName:"p"},"deletes the file")," from our bucket."),(0,r.kt)("p",null,"If we are using Upload with a possibility to upload only one file, we are also deleting already uploaded file if we would upload new one.\nSame API endpoint is called and after the old uploaded file will be deleted, a new one will be uploaded with another endpoint.\nBasically, it's ",(0,r.kt)("strong",{parentName:"p"},"replacing")," old uploaded file with a new one."),(0,r.kt)("h2",{id:"usage-in-rjsf"},"Usage in RJSF"),(0,r.kt)("p",null,"Upload widget is possible to fully use in RJSF forms. This widget is returning string or array of strings.\nThis string represents name of uploaded file. Files with error are not returned."))}u.isMDXComponent=!0}}]);