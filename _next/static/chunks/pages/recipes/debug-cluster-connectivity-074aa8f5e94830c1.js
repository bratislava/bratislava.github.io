(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2338],{7380:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/recipes/debug-cluster-connectivity",function(){return t(5552)}])},3957:function(e,n,t){"use strict";var a=t(5893);t(7294);let r={logo:(0,a.jsx)("span",{children:"\uD83D\uDCDA Bratislava Documentation"}),project:{link:"https://github.com/bratislava"},docsRepositoryBase:"https://github.com/bratislava/bratislava.github.io",footer:{text:"Department of Innovation and Technology of the City of Bratislava"},faviconGlyph:"\uD83D\uDCDA"};n.Z=r},5552:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return d.ZP}});var a,r=t(5893),i=t(2720),s=t(3957);t(5513);var o=t(1151);t(5675);var d=t(1235);let l={filePath:"pages/recipes/debug-cluster-connectivity.md",route:"/recipes/debug-cluster-connectivity",frontMatter:{},pageMap:[{kind:"Meta",data:{index:"Introduction","bratislava.sk":"Bratislava.sk","deployment-and-infrastructure":"Deployment and Infrastructure",graphql:"GraphQL",meilisearch:"Meilisearch",nestjs:"Nestjs",other:"Other",recipes:"Recipes",strapi:"Strapi"}},{kind:"Folder",name:"bratislava.sk",route:"/bratislava.sk",children:[{kind:"MdxPage",name:"add-new-component-to-sections",route:"/bratislava.sk/add-new-component-to-sections"},{kind:"MdxPage",name:"colors-and-themes",route:"/bratislava.sk/colors-and-themes"},{kind:"MdxPage",name:"forms-general",route:"/bratislava.sk/forms-general"},{kind:"MdxPage",name:"forms-uischema",route:"/bratislava.sk/forms-uischema"},{kind:"MdxPage",name:"forms-upload-file",route:"/bratislava.sk/forms-upload-file"},{kind:"MdxPage",name:"meilisearch-setup",route:"/bratislava.sk/meilisearch-setup"},{kind:"MdxPage",name:"react-component-structure",route:"/bratislava.sk/react-component-structure"},{kind:"Meta",data:{"add-new-component-to-sections":"Add New Component to Sections","colors-and-themes":"Colors and Themes","forms-general":"Forms General","forms-uischema":"Forms Uischema","forms-upload-file":"Forms Upload File","meilisearch-setup":"Meilisearch Setup","react-component-structure":"React Component Structure"}}]},{kind:"Folder",name:"deployment-and-infrastructure",route:"/deployment-and-infrastructure",children:[{kind:"MdxPage",name:"backups",route:"/deployment-and-infrastructure/backups"},{kind:"MdxPage",name:"database-backups",route:"/deployment-and-infrastructure/database-backups"},{kind:"MdxPage",name:"deployment",route:"/deployment-and-infrastructure/deployment"},{kind:"MdxPage",name:"grafana",route:"/deployment-and-infrastructure/grafana"},{kind:"Meta",data:{backups:"Backups","database-backups":"Database Backups",deployment:"Deployment",grafana:"Grafana"}}]},{kind:"MdxPage",name:"graphql",route:"/graphql"},{kind:"MdxPage",name:"index",route:"/",frontMatter:{sidebar_position:1}},{kind:"MdxPage",name:"meilisearch",route:"/meilisearch"},{kind:"Folder",name:"nestjs",route:"/nestjs",children:[{kind:"MdxPage",name:"Authentication",route:"/nestjs/Authentication"},{kind:"MdxPage",name:"CardWebPay",route:"/nestjs/CardWebPay"},{kind:"MdxPage",name:"Controllers",route:"/nestjs/Controllers"},{kind:"MdxPage",name:"Kubernetes",route:"/nestjs/Kubernetes"},{kind:"MdxPage",name:"Logging",route:"/nestjs/Logging"},{kind:"MdxPage",name:"Module",route:"/nestjs/Module"},{kind:"MdxPage",name:"NestJS",route:"/nestjs/NestJS",frontMatter:{sidebar_position:1}},{kind:"MdxPage",name:"OpenAPI",route:"/nestjs/OpenAPI"},{kind:"MdxPage",name:"Prisma",route:"/nestjs/Prisma"},{kind:"MdxPage",name:"ProjectStructure",route:"/nestjs/ProjectStructure"},{kind:"MdxPage",name:"RestApi",route:"/nestjs/RestApi"},{kind:"MdxPage",name:"Sentry",route:"/nestjs/Sentry"},{kind:"MdxPage",name:"Services",route:"/nestjs/Services"},{kind:"MdxPage",name:"Testing",route:"/nestjs/Testing"},{kind:"Meta",data:{Authentication:"Authentication",CardWebPay:"Cardwebpay",Controllers:"Controllers",Kubernetes:"Kubernetes",Logging:"Logging",Module:"Module",NestJS:"Nestjs",OpenAPI:"Openapi",Prisma:"Prisma",ProjectStructure:"Projectstructure",RestApi:"Restapi",Sentry:"Sentry",Services:"Services",Testing:"Testing"}}]},{kind:"Folder",name:"other",route:"/other",children:[{kind:"MdxPage",name:"developer-accesses",route:"/other/developer-accesses",frontMatter:{sidebar_position:2}},{kind:"MdxPage",name:"meetings-syncs-rituals",route:"/other/meetings-syncs-rituals",frontMatter:{sidebar_position:3}},{kind:"Meta",data:{"developer-accesses":"Developer Accesses","meetings-syncs-rituals":"Meetings Syncs Rituals"}}]},{kind:"Folder",name:"recipes",route:"/recipes",children:[{kind:"Folder",name:"alerting",route:"/recipes/alerting",children:[{kind:"MdxPage",name:"contact-point",route:"/recipes/alerting/contact-point"},{kind:"MdxPage",name:"endpoint_alert",route:"/recipes/alerting/endpoint_alert"},{kind:"MdxPage",name:"grafana_alerting",route:"/recipes/alerting/grafana_alerting",frontMatter:{sidebar_position:1}},{kind:"MdxPage",name:"log_alert",route:"/recipes/alerting/log_alert"},{kind:"MdxPage",name:"resource_alert",route:"/recipes/alerting/resource_alert"},{kind:"Meta",data:{"contact-point":"Contact Point",endpoint_alert:"Endpoint Alert",grafana_alerting:"Grafana Alerting",log_alert:"Log Alert",resource_alert:"Resource Alert"}}]},{kind:"MdxPage",name:"connecting-to-kubernetes",route:"/recipes/connecting-to-kubernetes"},{kind:"MdxPage",name:"debug-cluster-connectivity",route:"/recipes/debug-cluster-connectivity"},{kind:"MdxPage",name:"docker-setup",route:"/recipes/docker-setup"},{kind:"MdxPage",name:"editor-setup",route:"/recipes/editor-setup"},{kind:"MdxPage",name:"env-vars-and-secrets",route:"/recipes/env-vars-and-secrets"},{kind:"MdxPage",name:"git-workflow",route:"/recipes/git-workflow"},{kind:"MdxPage",name:"kubernetes-lens-setup",route:"/recipes/kubernetes-lens-setup"},{kind:"MdxPage",name:"postgres-setup",route:"/recipes/postgres-setup"},{kind:"MdxPage",name:"production-deployment-checklist",route:"/recipes/production-deployment-checklist"},{kind:"MdxPage",name:"sentry-setup",route:"/recipes/sentry-setup"},{kind:"MdxPage",name:"wsl",route:"/recipes/wsl"},{kind:"Meta",data:{alerting:"Alerting","connecting-to-kubernetes":"Connecting to Kubernetes","debug-cluster-connectivity":"Debug Cluster Connectivity","docker-setup":"Docker Setup","editor-setup":"Editor Setup","env-vars-and-secrets":"Env Vars and Secrets","git-workflow":"Git Workflow","kubernetes-lens-setup":"Kubernetes Lens Setup","postgres-setup":"Postgres Setup","production-deployment-checklist":"Production Deployment Checklist","sentry-setup":"Sentry Setup",wsl:"Wsl"}}]},{kind:"Folder",name:"strapi",route:"/strapi",children:[{kind:"MdxPage",name:"general-concepts",route:"/strapi/general-concepts",frontMatter:{sidebar_position:1}},{kind:"MdxPage",name:"load-strapi-db-in-local-dev",route:"/strapi/load-strapi-db-in-local-dev"},{kind:"MdxPage",name:"setup",route:"/strapi/setup",frontMatter:{sidebar_position:2}},{kind:"MdxPage",name:"sync-strapi-db-to-different-env",route:"/strapi/sync-strapi-db-to-different-env"},{kind:"Meta",data:{"general-concepts":"General Concepts","load-strapi-db-in-local-dev":"Load Strapi Db in Local Dev",setup:"Setup","sync-strapi-db-to-different-env":"Sync Strapi Db to Different Env"}}]}],headings:[{type:"heading",depth:1,children:[{type:"text",value:"Debugging k8s cluster connectivity to an outside service",position:{start:{line:1,column:3,offset:2},end:{line:1,column:59,offset:58}}}],position:{start:{line:1,column:1,offset:0},end:{line:1,column:59,offset:58}},value:"Debugging k8s cluster connectivity to an outside service"},{type:"heading",depth:3,children:[{type:"text",value:"Connect to proper Kubernetes cluster",position:{start:{line:6,column:8,offset:362},end:{line:6,column:44,offset:398}}}],position:{start:{line:6,column:4,offset:358},end:{line:6,column:44,offset:398}},value:"Connect to proper Kubernetes cluster"},{type:"heading",depth:3,children:[{type:"text",value:"Check if your service is running in a pod.",position:{start:{line:17,column:8,offset:675},end:{line:17,column:50,offset:717}}}],position:{start:{line:17,column:4,offset:671},end:{line:17,column:50,offset:717}},value:"Check if your service is running in a pod."},{type:"heading",depth:3,children:[{type:"text",value:"Create a new debug pod with ubuntu",position:{start:{line:34,column:8,offset:1075},end:{line:34,column:42,offset:1109}}}],position:{start:{line:34,column:4,offset:1071},end:{line:34,column:42,offset:1109}},value:"Create a new debug pod with ubuntu"},{type:"heading",depth:3,children:[{type:"text",value:"Install needed debugging utilities for ubuntu",position:{start:{line:45,column:8,offset:1767},end:{line:45,column:53,offset:1812}}}],position:{start:{line:45,column:4,offset:1763},end:{line:45,column:53,offset:1812}},value:"Install needed debugging utilities for ubuntu"},{type:"heading",depth:3,children:[{type:"text",value:"Clean Up",position:{start:{line:60,column:8,offset:2171},end:{line:60,column:16,offset:2179}}}],position:{start:{line:60,column:4,offset:2167},end:{line:60,column:16,offset:2179}},value:"Clean Up"}],flexsearch:{codeblocks:!0}};globalThis.__nextra_internal__={pageMap:l.pageMap,route:l.route};let c="Debugging k8s cluster connectivity to an outside service";function u(e){let n=Object.assign({h1:"h1",p:"p",a:"a",br:"br",code:"code",ol:"ol",li:"li",h3:"h3",div:"div",pre:"pre",span:"span",ul:"ul"},(0,o.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{children:"Debugging k8s cluster connectivity to an outside service"}),"\n",(0,r.jsxs)(n.p,{children:["To debug running pods in kubernetes you can follow official guide - ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/",children:"https://kubernetes.io/docs/tasks/debug/debug-application/debug-running-pod/"}),".",(0,r.jsx)(n.br,{}),"\n","Following is just a small example in our local context. Let's assume you want to check if you can ping a service from the ",(0,r.jsx)(n.code,{children:"next-city-library"})," pod."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.h3,{id:"connect-to-proper-kubernetes-cluster",children:"Connect to proper Kubernetes cluster"}),"\n",(0,r.jsxs)(n.p,{children:["In our case, we will connect to ",(0,r.jsx)(n.code,{children:"tkg-innov-dev"}),". You can follow our ",(0,r.jsx)(n.a,{href:"./kubernetes-lens-setup",children:"Login guide"}),".\nTo verify that you are correctly connected you can run"]}),"\n",(0,r.jsx)(n.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(n.span,{className:"line",children:(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"kubectl config current-context"})})})})}),"\n",(0,r.jsxs)(n.p,{children:["The output should match ",(0,r.jsx)(n.code,{children:"tkg-innov-dev"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.h3,{id:"check-if-your-service-is-running-in-a-pod",children:"Check if your service is running in a pod."}),"\n",(0,r.jsx)(n.p,{children:"Run"}),"\n",(0,r.jsx)(n.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(n.span,{className:"line",children:(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"kubectl get pods --all-namespaces"})})})})}),"\n",(0,r.jsxs)(n.p,{children:["and find your desired pod and copy its name like: ",(0,r.jsx)(n.code,{children:"next-city-library-app-b868fcd5c-lj6tb"}),".",(0,r.jsx)(n.br,{}),"\n","If you are running a reasonable ",(0,r.jsx)(n.code,{children:"*nix"})," shell, you can do"]}),"\n",(0,r.jsx)(n.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsxs)(n.span,{className:"line",children:[(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"kubectl get pods --all-namespaces "}),(0,r.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" grep "}),(0,r.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"next-city-library"'})]})})})}),"\n",(0,r.jsx)(n.p,{children:"which should help with finding your POD."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.h3,{id:"create-a-new-debug-pod-with-ubuntu",children:"Create a new debug pod with ubuntu"}),"\n",(0,r.jsx)(n.p,{children:"Now we will create a new debug pod with ubuntu, and we will attach the container to the pod so we can easily debug it.\nRun following command to create a new debug POD, which will be a exact copy of your original container (you can read more information in the official docs)"}),"\n",(0,r.jsx)(n.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(n.span,{className:"line",children:(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"kubectl debug next-city-library-app-b868fcd5c-lj6to -it --namespace=bratislava-monorepo --image=ubuntu --share-processes --copy-to=next-city-library-app-debug"})})})})}),"\n",(0,r.jsxs)(n.p,{children:["Don't forget to update the proper pod and ",(0,r.jsx)(n.code,{children:"--copy-to"})," to the name you want. Under ",(0,r.jsx)(n.code,{children:"--copy-to"}),", you will find the running pod. This command will also attach you to newly created POD."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.h3,{id:"install-needed-debugging-utilities-for-ubuntu",children:"Install needed debugging utilities for ubuntu"}),"\n",(0,r.jsx)(n.p,{children:"Before any installations run, you might need to run"}),"\n",(0,r.jsx)(n.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(n.span,{className:"line",children:(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo apt update --yes"})})})})}),"\n",(0,r.jsx)(n.p,{children:"For debugging, you will probably need some networking tools. You can install it with these commands:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["ping: ",(0,r.jsx)(n.code,{children:"apt-get install iputils-ping"})]}),"\n",(0,r.jsxs)(n.li,{children:["nslookup: ",(0,r.jsx)(n.code,{children:"apt-get install dnsutils"})]}),"\n",(0,r.jsxs)(n.li,{children:["wget: ",(0,r.jsx)(n.code,{children:"apt install wget"})]}),"\n",(0,r.jsxs)(n.li,{children:["curl: ",(0,r.jsx)(n.code,{children:"apt install curl"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.h3,{id:"clean-up",children:"Clean Up"}),"\n",(0,r.jsx)(n.p,{children:"After you are done with debugging, please clean up after yourself and delete the pods that you have created and no longer need. For example you can delete our debug pod with following command"}),"\n",(0,r.jsx)(n.div,{"data-rehype-pretty-code-fragment":"",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{"data-language":"bash","data-theme":"default",children:(0,r.jsx)(n.span,{className:"line",children:(0,r.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"kubectl delete pod next-city-library-app-debug --namespace=bratislava-monorepo"})})})})}),"\n"]}),"\n"]})]})}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.ah)(),e.components);return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}l.title="string"==typeof c&&c||"Debug Cluster Connectivity";let g=e=>(0,r.jsx)(i.mK.Provider,{value:e,children:(0,r.jsx)(p,{})});(a=globalThis).__nextra_pageContext__||(a.__nextra_pageContext__=Object.create(null)),globalThis.__nextra_pageContext__["/recipes/debug-cluster-connectivity"]={Content:g,pageOpts:l,themeConfig:s.Z}}},function(e){e.O(0,[9774,5860,2888,179],function(){return e(e.s=7380)}),_N_E=e.O()}]);